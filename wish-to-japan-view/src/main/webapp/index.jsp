<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">

<head>
	<title>Promo My Big Wish Live | Blibli.com</title>
	<meta charset="UTF-8">
	<meta name="description" content="Dapatkan voucher langsung 100 ribu untuk pembelian produk pilihan di blibli.com dengan cicilan 0% dan gratis pengiriman dan menangkan hadiah impianmu">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://www.blibli.com/wcsstore/Indraprastha/images/gdn/images/favicon.ico" rel="shortcut icon">
	<link rel="stylesheet" href="_asset/style.css">
	<link rel="stylesheet" href="_asset/css/main.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
	<script src="_asset/js/sweetalert.min.js"></script>
	<script src="_asset/js/reconnect.js"></script>
	<script src="_asset/js/main.js"></script>

	<!-- set Google tag manager section-->
	<!-- Google tag manager-->
	<noscript>
		<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PHC5L2" height="0" width="0" style="display:none;visibility:hidden"></iframe>
	</noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PHC5L2');</script>
	<!-- End google tag manager-->

	<script>
		var _gaq=_gaq||[];
		var pluginUrl='https://www.google-analytics.com/plugins/ga/inpage_linkid.js';
		_gaq.push(['_require','inpage_linkid',pluginUrl]);
		_gaq.push(['_setAccount','UA-21718848-1']);
		_gaq.push(['_setDomainName','blibli.com']);
		_gaq.push(['_trackPageview']);
		(function(){
			var ga=document.createElement('script');
			ga.type='text/javascript';
			ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'https://www')+'.google-analytics.com/ga.js';
			var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();
	</script>

	<script type="text/javascript">
		var _bwaq = _bwaq || [];
		_bwaq.push(['_setAccount', 'blibli']);
		_bwaq.push(['_trackPageView', 'promo', '-1002']);

		(function() {
			var bwa = document.createElement('script');
			bwa.type = 'text/javascript';
			bwa.async = true;
			bwa.src = 'https://www.blibli.com/wcsstore/bwa.js'

			var s = document.getElementsByTagName('script')[0];
			s.parentNode.insertBefore(bwa, s);
		})();
	</script>

	<style type = 'text/css'>
	</style>

	<!--[if lt IE 9]>
	<script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
</head>
<body>
<header id="branding" class="wide top-bar">
	<div class="row">
		<div class="half push-left branding">
			<a href="https://www.blibli.com/" class="logo-atas" title="go to blibli.com"><img src="https://www.blibli.com/resources/images/logo-blibli.png" alt="logo blibli | header"></a>
		</div>
		<!--<div class="half push-right text-right">
      <div style="padding-top:2.5em;">Beritahu Teman:</div>
      <div class="share" data-url=""></div>
    </div>-->
	</div>
</header>

<div class="row">
	<div class='header'>
		<img src='_asset/images/header.png' alt='my big wish | blibli' style="display:block;" />
	</div>

	<div class="slot-wrapper container">

		<div class="bg-awan">

			<div class="transparant"></div>

			<div id='slot-holder'>
				<div class="time-wrapper" id="raffle-holder">
					<div class = 'jpn-wrapper'>
						<ul class='slot-fix'>
							<li>J</li>
							<li>P</li>
							<li>N</li>
						</ul>
					</div>
					<ul class="slot" id='unilever-slot'>
						<li>&nbsp;</li>
						<li>U</li>
						<li>&nbsp;</li>
						<li>U</li>
						<li>&nbsp;</li>
						<li>U</li>
					</ul>
					<div class = 'jpn-wrapper'>
						<ul class='slot-fix'>
							<li>&ndash;</li>
						</ul>
					</div>
					<ul class="slot" id='code-slot1'>
						<li><span>1</span></li>
						<li><span>2</span></li>
						<li><span>3</span></li>
						<li><span>4</span></li>
						<li><span>5</span></li>
						<li><span>6</span></li>
						<li><span>7</span></li>
						<li><span>8</span></li>
						<li><span>9</span></li>
						<li><span>0</span></li>
						<li><span>*</span></li>
						<li><span>A</span></li>
						<li><span>B</span></li>
						<li><span>C</span></li>
						<li><span>D</span></li>
						<li><span>E</span></li>
						<li><span>F</span></li>
						<li><span>G</span></li>
						<li><span>H</span></li>
						<li><span>I</span></li>
						<li><span>J</span></li>
						<li><span>K</span></li>
						<li><span>L</span></li>
						<li><span>M</span></li>
						<li><span>N</span></li>
						<li><span>O</span></li>
						<li><span>P</span></li>
						<li><span>Q</span></li>
						<li><span>R</span></li>
						<li><span>S</span></li>
						<li><span>T</span></li>
						<li><span>U</span></li>
						<li><span>V</span></li>
						<li><span>W</span></li>
						<li><span>X</span></li>
						<li><span>Y</span></li>
						<li><span>Z</span></li>
					</ul>
					<div class = 'jpn-wrapper'>
						<ul class='slot-fix'>
							<li>&ndash;</li>
						</ul>
					</div>
					<ul class="slot" id='code-slot2'>
						<li><span>1</span></li>
						<li><span>2</span></li>
						<li><span>3</span></li>
						<li><span>4</span></li>
						<li><span>5</span></li>
						<li><span>6</span></li>
						<li><span>7</span></li>
						<li><span>8</span></li>
						<li><span>9</span></li>
						<li><span>0</span></li>
						<li><span>*</span></li>
						<li><span>A</span></li>
						<li><span>B</span></li>
						<li><span>C</span></li>
						<li><span>D</span></li>
						<li><span>E</span></li>
						<li><span>F</span></li>
						<li><span>G</span></li>
						<li><span>H</span></li>
						<li><span>I</span></li>
						<li><span>J</span></li>
						<li><span>K</span></li>
						<li><span>L</span></li>
						<li><span>M</span></li>
						<li><span>N</span></li>
						<li><span>O</span></li>
						<li><span>P</span></li>
						<li><span>Q</span></li>
						<li><span>R</span></li>
						<li><span>S</span></li>
						<li><span>T</span></li>
						<li><span>U</span></li>
						<li><span>V</span></li>
						<li><span>W</span></li>
						<li><span>X</span></li>
						<li><span>Y</span></li>
						<li><span>Z</span></li>
					</ul>
				</div>

				<div class="time-wrapper hidden" id="congratulations-raffle-holder">
					<ul class="slot" id="congratulations-slot">
						<li><span>-</span></li>
						<li><span>A</span></li>
						<li><span>B</span></li>
						<li><span>C</span></li>
						<li><span>D</span></li>
						<li><span>E</span></li>
						<li><span>F</span></li>
						<li><span>G</span></li>
						<li><span>H</span></li>
						<li><span>I</span></li>
						<li><span>J</span></li>
						<li><span>K</span></li>
						<li><span>L</span></li>
						<li><span>M</span></li>
						<li><span>N</span></li>
						<li><span>O</span></li>
						<li><span>P</span></li>
						<li><span>Q</span></li>
						<li><span>R</span></li>
						<li><span>S</span></li>
						<li><span>T</span></li>
						<li><span>U</span></li>
						<li><span>V</span></li>
						<li><span>W</span></li>
						<li><span>X</span></li>
						<li><span>Y</span></li>
						<li><span>Z</span></li>
						<li><span>!</span></li>
					</ul>
				</div>
			</div>

			<h2 id = 'jpn-name-holder'>&nbsp;</h2>

			<div id='pre-raffle-countdown-holder' class="hitungmundur" style="display: block;">
				<p>
					Bersiaplah! Pengundian pemenang akan dimulai dalam
				</p>
				<p><span id='pre-raffle-countdown' class='countdown'></span></p>
			</div>
		</div>

		<div id = 'action-box'>
			<!--<div id='pre-raffle-countdown-holder'>
        <p>
          Bersiaplah! Pengundian pemenang akan dimulai dalam
          <span id='pre-raffle-countdown-min'></span><span id='pre-raffle-countdown-sec'></span>
        </p>
      </div>-->
			<div id='second-prize' class='hidden'>
				<p>
					<span id='second-prize-state'></span> pemenang Liburan GRATIS ke Jepang telah terpilih hari ini.
				</p>
			</div>
			<div id='running' class='hidden'>
				<p>
					Apakah Anda Pemenang Grand Prize Liburan GRATIS ke Jepang <span id='grand-prize-state'></span>?
				</p>
			</div>
			<div id='running-rerun' class ='hidden'>
				<p>
					Masih ada kesempatan untuk menjadi pemenang Grand Prize Liburan GRATIS ke Jepang! Proses pengundian <span id='rerun-th'></span> akan diulang kembali,
					karena pemenang terpilih belum melakukan klaim hadiah.
				</p>
			</div>

			<div id='claiming' class='hidden'>
				<div class="hitungmundur" style="display: block;">
					<p>Klaim hadiah Anda sebelum</p>
					<p>
						<span id='claiming-countdown' class="countdown"></span>
					</p>
				</div>

				<div id='txt-claim-holder' class='hidden'>
					<input type="email" name="email" id='txt-claim' placeholder="MASUKKAN EMAIL ANDA">
				</div>
				<a class='btn' id='btn-claim'>KLAIM SEKARANG &blacktriangleright;</a>
			</div>

			<div id='claimed' class='hidden'>
				<div class="selamat-wrapper">
					<img src="_asset/images/image-globe.png">
					<h2>Selamat Anda memenangkan Grand Prize Liburan GRATIS ke Jepang</h2>
					<p>Customer Care kami akan segera menghubungi Anda untuk konfirmasi melalui telepon dan email dalam waktu 2x24 jam.</p>
				</div>
			</div>

			<div id='other-prizes-div-holder' class='hidden'>
				<p>Apakah Anda Pemenang Apple Macbook Pro, Kamera Fujifilm X-M1, Lenovo Phab Plus, dan Meizu M2?</p>
			</div>

			<div id='congratulations-holder' class='hidden'>
				<p>Bagi Anda yang belum beruntung, masih ada kesempatan menang di promo #MyBigWish periode 2 (pembelanjaan 11 - 31 Des 2015).<br>
				Terima kasih dan terus belanja di Blibli.com!</p>
			</div>
		</div>
	</div>

	<input type="button" class="hidden" id="playslot-wrapper" value="">
	<input type="button" class="hidden" id="play-congrats-slot-wrapper" value="">
</div>

<footer class="wide">
	<div class="row">
		<a id="backhome" href="https://www.blibli.com/" class="btn push-left gotohome" title="go to blibli.com | footer"><img src="_asset/images/backhome.png" alt="home | footer"></a>
		<a id="backtop" class="btn push-right gototop" title="go to top | footer"><img src="_asset/images/backtop.png" alt="top | footer"></a>
		<div class="push-center text-center">
			<p>Copyright &copy; 2011-2015 Blibli.com toko online dengan sensasi belanja online store ala mall, All Rights Reserved</p>
		</div>
	</div>
</footer>

<script type="text/javascript">
	var viewHost = "<%=request.getAttribute("viewHost")%>";
	var useWss = "<%=request.getAttribute("useWss")%>";
</script>
<script src="_asset/js/jquery.easing.1.3.js" type="text/javascript" charset="utf-8"></script>
<script src="_asset/js/jquery.jSlots.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" charset="utf-8">
	// SELECTORS
	var slotHolder = $("#slot-holder");
	var countdown = $("#countdown");
	var sequenceHolder = $("#grand-prize-state");
	var claimingCountdown = $("#claiming-countdown");
	var nameHolder = $('#jpn-name-holder');
	var runningDivHolder = $("#action-box #running");
	var runningRerunDivHolder = $("#action-box #running-rerun");
	var claimingDivHolder = $("#action-box #claiming");
	var claimedDivHolder = $("#action-box #claimed");
	var otherPrizesDivHolder = $("#action-box #other-prizes-div-holder");
	var congratulationsHolder = $("#action-box #congratulations-holder");
	var secondPrizeHolder = $("#action-box #second-prize");
	var secondPrizeStateHolder = $("#action-box #second-prize-state");
	var grandPrizeStateHolder = $("#grand-prize-state");
	var btnClaim = $("#btn-claim");
	var txtClaimHolder = $("#txt-claim-holder");
	var txtClaim = $("#txt-claim");
	var rerunTh = $("#rerun-th");
	var winnerQty = $("#winner-qty");
	var preRaffleCountdownHolder = $("#pre-raffle-countdown-holder");
	var preRaffleCountdown = $("#pre-raffle-countdown");

	// STATE CONSTANTS
	var PROMO_ON = "ON";
	var PROMO_OFF = "OFF";
	var RAFFLE_RUNNING = "RUNNING";
	var RAFFLE_CLAIMING = "CLAIMING";
	var RAFFLE_OTHERS_RUNNING = "OTHERS_RUNNING";
	var RAFFLE_OTHERS_ENDING = "OTHERS_ENDING";

	var SEQUENCE_WORDS = ["Pertama", "Kedua", "Ketiga"];
	var NUMBERS = ["Satu", "Dua", "Tiga"];
	var SLOT_INTERVAL = 20;
	var UNILEVER_SLOT_INTERVAL = 500;
	var WINNERS_PAGE = "/winners.jsp";
	var CLAIM_PRIZE_URL = "/api/claim-winner";
	var CHECK_TIME_URL = "/api/check-time";
	var CONGRATULATIONS_WORDING_NAME = "Selamat kepada para pemenang terpilih!";

	var displayCodePart1 = [1,2,3,4,5];
	var displayCodePart2 = [6,7,8,9,10];
	var unileverValue = [1];
	var currentName;
	var hasRunOnce = false;

	var ws;
	var timerID;

	function startWS() {
		var wsProtocol = "";
		if (useWss !== 'true') {
			wsProtocol = "wss://";
		} else {
			wsProtocol = "ws://";
		}
		ws = new ReconnectingWebSocket(wsProtocol + viewHost +"/luckyDip", null, {reconnectInterval: 1000});
		ws.onmessage = function (message) {
			onMessageWS(message);
		}
	}

	function onOpenWS() {
		if (window.timerID) {
			window.clearInterval(window.timerID);
			window.timerID = 0;
		}
	};

	function onCloseWS() {
		if (!window.timerID) {
			window.timerID = setInterval(function() {
				startWS();
			}, 1000);
		}
	};

	function onMessageWS(message) {
		var data = JSON.parse(message.data);
		var promoState = data.promoState;

		if (promoState == PROMO_ON) {
			var raffleState = data.raffleState;
			var prizeSequence = data.sequence;
			var candidateSequence = data.candidateSequence;
			var timer = data.timer;
			var cP = data.currentParticipant;
			var voucherCode = (cP !== undefined)? cP.voucherCode : null;
			var name = (cP !== undefined)? cP.name : null;

			grandPrizeStateHolder.html(SEQUENCE_WORDS[prizeSequence - 1]);
			rerunTh.html(SEQUENCE_WORDS[prizeSequence - 1].toLowerCase());

			setTimer(timer, claimingCountdown);

			switch (raffleState) {
				case RAFFLE_RUNNING:
					hasRunOnce = false;

					if (candidateSequence > 1) {
						hideAllBut(runningRerunDivHolder);
					} else {
						hideAllBut(runningDivHolder);
					}

					if (prizeSequence > 1) {
						showElement(secondPrizeHolder);
						secondPrizeStateHolder.html(NUMBERS[prizeSequence - 2]);
					}

					getCurrent(voucherCode, name);
					runSlot();
					break;
				case RAFFLE_CLAIMING:
					if (!hasRunOnce) {
						getCurrent(voucherCode, name);
						runSlot();
						hasRunOnce = true;
					}
					hideAllBut(claimingDivHolder);
					break;
				case RAFFLE_OTHERS_RUNNING:
					runSlot();
					getCurrent(voucherCode, name);
					hideAllBut(otherPrizesDivHolder);
					showElement(secondPrizeHolder);
					secondPrizeStateHolder.html(NUMBERS[prizeSequence - 1]);
					break;
				case RAFFLE_OTHERS_ENDING:
					winnerQty.html(NUMBERS[prizeSequence - 1]);
					showCongratulations();
					break;
				default:
					hideAllBut();
					break;
			}
		} else {
			window.location = WINNERS_PAGE;
			ws = null;
		}
	};

	function showElement(element) {
		element.css("display","block");
	}

	function hide(el) {
		if (el.css("display") != "none") {
			el.css("display","none");
		}
	}

	function hideAllBut(element) {
		hide(runningDivHolder);
		hide(claimingDivHolder);
		hide(claimedDivHolder);
		hide(otherPrizesDivHolder);
		hide(congratulationsHolder);
		hide(runningRerunDivHolder);
		hide(secondPrizeHolder);

		if (element) {
			if (element.css("display") != "block") {
				element.css("display", "block");
			}
		}
	}

	function runSlot() {
		$('#playslot-wrapper').click();
		nameHolder.html(currentName);
	}

	function setTimer(seconds, selector) {
		var finalDisplayTime = "";
		var day = Math.floor(seconds / (3600 * 24));
		var hour = Math.floor((seconds / 3600) % 24);
		var min = Math.floor((seconds / 60) % 60);
		var sec = Math.floor(seconds % 60);

		finalDisplayTime += showOrHideTimerPart(day, "hari");
		finalDisplayTime += showOrHideTimerPart(hour, "jam");
		finalDisplayTime += showOrHideTimerPart(min, "menit");
		finalDisplayTime += showOrHideTimerPart(sec, "detik");

		if (finalDisplayTime == "") {
			finalDisplayTime = "&nbsp;"
		}

		selector.html(finalDisplayTime);
	}

	function showOrHideTimerPart(part, partString) {
		if (part > 0) {
			return part + " " + partString + " ";
		}
		return "";
	}

	function getCurrent(voucherCode, name) {
		var codeParts = voucherCode.split("-");
		var jpnOrJpnu = codeParts[0];

		if (jpnOrJpnu.length > 3) {
			unileverValue[0] = 2;
		} else {
			unileverValue[0] = 1;
		}

		parseCode(codeParts[1], displayCodePart1);
		parseCode(codeParts[2], displayCodePart2);

		currentName = name;
	}

	function parseCode(voucherCode, destination) {
		for (i = 0; i < 5; i++) {
			var charAtIdx = voucherCode.charAt(i).toUpperCase();

			if (charAtIdx == '0') {
				charAtIdx = 10;
			} else if (charAtIdx == '*') {
				charAtIdx = 11;
			} else if (charAtIdx >= 'A' && charAtIdx <= 'Z') {
				charAtIdx = charAtIdx.charCodeAt(0) - "A".charCodeAt(0) + 12;
			}
			destination[i] = charAtIdx;
		}
	}

	function showCongratulations() {
		$("#raffle-holder").addClass("hidden");
		$("#congratulations-raffle-holder").removeClass("hidden");

		hideAllBut(congratulationsHolder);
		$("#play-congrats-slot-wrapper").click();
		nameHolder.html(CONGRATULATIONS_WORDING_NAME);

		showCongratulations = Function("");
	}

	$("#congratulations-slot").jSlots({
		number : 16,
		winnerNumber : 1,
		spinner: '#play-congrats-slot-wrapper',
		easing : 'easeOutSine',
		time : 3000,
		loops : 3,
		endNumbers : [4,16,15,8,19,2,21,22,13,2,21,10,16,15,20,28]
	});

	$('.slot-wrapper #code-slot1').jSlots({
		number : 5,
		winnerNumber : 1,
		spinner : '#playslot-wrapper',
		easing : 'easeOutSine',
		time : SLOT_INTERVAL,
		loops : 1,
		endNumbers : displayCodePart1
	});

	$('.slot-wrapper #code-slot2').jSlots({
		number : 5,
		winnerNumber : 1,
		spinner : '#playslot-wrapper',
		easing : 'easeOutSine',
		time : SLOT_INTERVAL,
		loops : 1,
		endNumbers : displayCodePart2
	});

	$('#unilever-slot').jSlots({
		number : 1,
		winnerNumber : 1,
		spinner : '#playslot-wrapper',
		easing : 'easeOutSine',
		time : UNILEVER_SLOT_INTERVAL / 4,
		loops : 1,
		endNumbers : unileverValue
	});

	function startCountdown(time) {
		if (time > 0) {
			hide(slotHolder);
			hide(nameHolder);
			showElement(preRaffleCountdownHolder);
			setTimer(time, preRaffleCountdown);

			setTimeout(function() {
				time--;
				startCountdown(time);
			}, 1000);
		} else {
			hide(preRaffleCountdownHolder);
			showElement(nameHolder);
			showElement(slotHolder);
			startWS();
		}
	}

	$(document).ready(function() {
		hideAllBut();
		hide(slotHolder);
		hide(nameHolder);

		$.ajax({
			type: 'GET',
			url: CHECK_TIME_URL
		}).done(function(data) {
			if (data != '') {
				startCountdown(data);
			} else {
				swal({
					title: "Error!",
					text: "Invalid data",
					type: "error",
					confirmButtonText: "Close"
				});
			}
		}).fail(function() {
			swal({
				title: "Error!",
				text: "Gagal komunikasi dengan server",
				type: "error",
				confirmButtonText: "Close"
			});
		});

		btnClaim.click(function() {
			var isShown = txtClaimHolder.css("display") == "block";
			var email = txtClaim.val().trim();

			if (isShown && email != '') {
				$.ajax({
					type: 'POST',
					url: CLAIM_PRIZE_URL,
					data: {e: email}
				}).done(function(data) {
					if (data == 'true') {
						ws.onmessage = Function("");
						hide(txtClaimHolder);
						hideAllBut(claimedDivHolder);
					} else {
						swal({
							title: "Error!",
							text: "Maaf, email yang Anda masukkan tidak sesuai dengan email pemenang terdaftar. Pastikan Anda memasukkan alamat email yang benar dan sesuai. Silakan coba kembali.",
							type: "error",
							confirmButtonText: "Close"
						});
					}
				}).fail(function() {
					swal({
						title: "Error!",
						text: "Gagal komunikasi dengan server",
						type: "error",
						confirmButtonText: "Close"
					});
				});
			} else {
				showElement(txtClaimHolder);
			}
		});
	});

</script>
</body>
</html>	
